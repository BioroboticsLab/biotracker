
set(APPIMAGE_APP_DIRECTORY "${CPACK_TEMPORARY_DIRECTORY}/appdir")
file(REMOVE_RECURSE "${APPIMAGE_APP_DIRECTORY}")
file(MAKE_DIRECTORY "${APPIMAGE_APP_DIRECTORY}")

file(COPY "${CPACK_TEMPORARY_DIRECTORY}/@CMAKE_INSTALL_BINDIR@" DESTINATION "${APPIMAGE_APP_DIRECTORY}/usr")
file(COPY "${CPACK_TEMPORARY_DIRECTORY}/@CMAKE_INSTALL_LIBDIR@" DESTINATION "${APPIMAGE_APP_DIRECTORY}/usr")
file(COPY "${CPACK_TEMPORARY_DIRECTORY}/@CMAKE_INSTALL_DATAROOTDIR@" DESTINATION "${APPIMAGE_APP_DIRECTORY}/usr")

file(RENAME "${APPIMAGE_APP_DIRECTORY}/usr/@CMAKE_INSTALL_BINDIR@" "${APPIMAGE_APP_DIRECTORY}/usr/bin")
file(RENAME "${APPIMAGE_APP_DIRECTORY}/usr/@CMAKE_INSTALL_LIBDIR@" "${APPIMAGE_APP_DIRECTORY}/usr/lib")
file(RENAME "${APPIMAGE_APP_DIRECTORY}/usr/@CMAKE_INSTALL_DATAROOTDIR@" "${APPIMAGE_APP_DIRECTORY}/usr/share")

execute_process(COMMAND "@LINUXDEPLOYQT_EXECUTABLE@"
    ${APPIMAGE_APP_DIRECTORY}/usr/share/applications/BioTracker.desktop -bundle-non-qt-libs -appimage -no-translations)

file(GLOB LINUXDEPLOYQT_OUTPUT_FILE RELATIVE "${CPACK_PACKAGE_DIRECTORY}" "BioTracker-*.AppImage")
if(LINUXDEPLOYQT_OUTPUT_FILE)
    file(RENAME "${CPACK_PACKAGE_DIRECTORY}/${LINUXDEPLOYQT_OUTPUT_FILE}" "${CPACK_PACKAGE_DIRECTORY}/@APPIMAGE_FILE_NAME@.AppImage")
endif()
